{% extends "base.html" %}

{% block title %}Batches - Mohi Industries ERP{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <div>
        <h2 class="text-3xl font-bold text-gray-800 dark:text-white">Batch Tracking (FSSAI Compliance)</h2>
        <p class="text-gray-600 dark:text-gray-400">Track manufacturing and expiry dates for all products</p>
    </div>
    <div class="flex space-x-2">
        <a href="{{ url_for('inventory.add_batch') }}"
            class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded shadow-lg shadow-green-500/30 transition-all dark:bg-green-600 dark:hover:bg-green-700">
            + Add Batch
        </a>
        <a href="{{ url_for('inventory.expiring_batches') }}"
            class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded shadow-lg shadow-red-500/30 transition-all dark:bg-red-600 dark:hover:bg-red-700">
            Expiring Soon
        </a>
    </div>
</div>

{% if batches %}
<div
    class="bg-white dark:bg-dark-surface rounded-lg shadow dark:shadow-none border border-transparent dark:border-dark-border">
    <div class="p-6">
        <div class="overflow-x-auto">
            <table class="min-w-full">
                <thead>
                    <tr class="border-b dark:border-dark-border">
                        <th class="text-left py-3 text-gray-600 dark:text-gray-400 font-semibold">Batch Number</th>
                        <th class="text-left py-3 text-gray-600 dark:text-gray-400 font-semibold">Product</th>
                        <th class="text-left py-3 text-gray-600 dark:text-gray-400 font-semibold">Mfg Date</th>
                        <th class="text-left py-3 text-gray-600 dark:text-gray-400 font-semibold">Expiry Date</th>
                        <th class="text-left py-3 text-gray-600 dark:text-gray-400 font-semibold">Days to Expiry</th>
                        <th class="text-left py-3 text-gray-600 dark:text-gray-400 font-semibold">Quantity</th>
                        <th class="text-left py-3 text-gray-600 dark:text-gray-400 font-semibold">Available</th>
                        <th class="text-left py-3 text-gray-600 dark:text-gray-400 font-semibold">QC Status</th>
                        <th class="text-left py-3 text-gray-600 dark:text-gray-400 font-semibold">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200 dark:divide-dark-border">
                    {% for batch in batches %}
                    <tr
                        class="border-b dark:border-dark-border hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors {% if batch.days_to_expiry() < 30 %}bg-red-50 dark:bg-red-900/10{% endif %}">
                        <td class="py-3 font-mono text-gray-900 dark:text-gray-300">{{ batch.batch_number }}</td>
                        <td class="py-3 font-semibold text-gray-900 dark:text-white">{{ batch.product.name }}</td>
                        <td class="py-3 text-gray-600 dark:text-gray-400">{{
                            batch.manufacturing_date.strftime('%d-%m-%Y') }}</td>
                        <td class="py-3 text-gray-600 dark:text-gray-400">{{ batch.expiry_date.strftime('%d-%m-%Y') }}
                        </td>
                        <td class="py-3">
                            {% if batch.days_to_expiry() < 0 %} <span class="text-red-600 dark:text-red-400 font-bold">
                                EXPIRED</span>
                                {% elif batch.days_to_expiry() < 30 %} <span
                                    class="text-orange-600 dark:text-orange-400 font-bold">{{ batch.days_to_expiry() }}
                                    days</span>
                                    {% else %}
                                    <span class="text-gray-900 dark:text-gray-300">{{ batch.days_to_expiry() }}
                                        days</span>
                                    {% endif %}
                        </td>
                        <td class="py-3 text-gray-900 dark:text-gray-300">{{ batch.quantity_produced }}</td>
                        <td class="py-3 text-gray-900 dark:text-gray-300 font-semibold">{{ batch.quantity_available }}
                        </td>
                        <td class="py-3">
                            <span
                                class="px-2 py-1 text-xs rounded font-medium {% if batch.qc_status == 'passed' %}bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400{% else %}bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400{% endif %}">
                                {{ batch.qc_status.upper() }}
                            </span>
                        </td>
                        <td class="py-3">
                            <div class="flex space-x-2">
                                <a href="{{ url_for('inventory.edit_batch', id=batch.id) }}"
                                    class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300">Edit</a>
                                <form method="POST" action="{{ url_for('inventory.delete_batch', id=batch.id) }}"
                                    class="inline" onsubmit="return confirm('Delete batch {{ batch.batch_number }}?');">
                                    <button type="submit"
                                        class="text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300">Delete</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% else %}
<div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 dark:bg-yellow-900/20 dark:border-yellow-600">
    <p class="text-yellow-700 dark:text-yellow-400">No batches found. Add batches to track manufacturing and expiry
        dates for FSSAI compliance.</p>
</div>
{% endif %}
{% endblock %}