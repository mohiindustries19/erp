{% extends "base.html" %}

{% block title %}Cash Flow Statement - Mohi Industries ERP{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Cash Flow Statement</h1>
        <div class="flex space-x-2">
            <a href="{{ url_for('accounting.export_cash_flow_excel', start_date=start_date, end_date=end_date) }}" class="bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded transition inline-flex items-center">
                üìä Export Excel
            </a>
            <a href="{{ url_for('accounting.print_cash_flow', start_date=start_date, end_date=end_date) }}" target="_blank" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition inline-flex items-center">
                üñ®Ô∏è Print
            </a>
            <a href="{{ url_for('accounting.dashboard') }}" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded transition">
                ‚Üê Dashboard
            </a>
        </div>
    </div>

    <!-- Date Range -->
    <div class="bg-white rounded-lg shadow-md p-4 mb-6">
        <form method="GET" class="flex items-end gap-4">
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">From Date</label>
                <input type="date" name="start_date" value="{{ start_date }}" 
                       class="px-4 py-2 border border-gray-300 rounded">
            </div>
            <div>
                <label class="block text-sm font-semibold text-gray-700 mb-1">To Date</label>
                <input type="date" name="end_date" value="{{ end_date }}" 
                       class="px-4 py-2 border border-gray-300 rounded">
            </div>
            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded transition">
                Generate Report
            </button>
        </form>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
            <p class="text-gray-600 text-sm">Cash Inflow</p>
            <p class="text-2xl font-bold text-green-600">‚Çπ{{ "%.2f"|format(total_inflow) }}</p>
        </div>
        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500">
            <p class="text-gray-600 text-sm">Cash Outflow</p>
            <p class="text-2xl font-bold text-red-600">‚Çπ{{ "%.2f"|format(total_outflow) }}</p>
        </div>
        <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-{% if net_cash_flow >= 0 %}blue{% else %}orange{% endif %}-500">
            <p class="text-gray-600 text-sm">Net Cash Flow</p>
            <p class="text-2xl font-bold {% if net_cash_flow >= 0 %}text-blue-600{% else %}text-orange-600{% endif %}">
                ‚Çπ{{ "%.2f"|format(net_cash_flow) }}
            </p>
        </div>
    </div>

    <!-- Cash Flow Details -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Cash Inflows -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold text-green-600 mb-4 border-b-2 border-green-600 pb-2">CASH INFLOWS</h2>
            <div class="space-y-2">
                {% for payment in cash_inflows %}
                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                    <div>
                        <p class="text-sm font-semibold text-gray-800">{{ payment.order.distributor.business_name }}</p>
                        <p class="text-xs text-gray-600">{{ payment.payment_date.strftime('%d-%m-%Y') }} | {{ payment.payment_mode }}</p>
                    </div>
                    <p class="text-sm font-bold text-green-600">‚Çπ{{ "%.2f"|format(payment.amount) }}</p>
                </div>
                {% endfor %}
                
                {% if not cash_inflows %}
                <p class="text-gray-500 text-center py-4">No cash inflows in this period</p>
                {% endif %}
            </div>
            <div class="mt-4 pt-4 border-t-2 border-green-600">
                <div class="flex justify-between items-center">
                    <p class="font-bold text-gray-800">Total Inflow</p>
                    <p class="text-xl font-bold text-green-600">‚Çπ{{ "%.2f"|format(total_inflow) }}</p>
                </div>
            </div>
        </div>

        <!-- Cash Outflows -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold text-red-600 mb-4 border-b-2 border-red-600 pb-2">CASH OUTFLOWS</h2>
            <div class="space-y-2">
                {% for expense in cash_outflows %}
                <div class="flex justify-between items-center py-2 border-b border-gray-100">
                    <div>
                        <p class="text-sm font-semibold text-gray-800">{{ expense.vendor_name or expense.account.account_name }}</p>
                        <p class="text-xs text-gray-600">{{ expense.expense_date.strftime('%d-%m-%Y') }} | {{ expense.payment_mode }}</p>
                    </div>
                    <p class="text-sm font-bold text-red-600">‚Çπ{{ "%.2f"|format(expense.total_amount) }}</p>
                </div>
                {% endfor %}
                
                {% if not cash_outflows %}
                <p class="text-gray-500 text-center py-4">No cash outflows in this period</p>
                {% endif %}
            </div>
            <div class="mt-4 pt-4 border-t-2 border-red-600">
                <div class="flex justify-between items-center">
                    <p class="font-bold text-gray-800">Total Outflow</p>
                    <p class="text-xl font-bold text-red-600">‚Çπ{{ "%.2f"|format(total_outflow) }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Net Cash Flow -->
    <div class="bg-white rounded-lg shadow-md p-6 mt-6">
        <div class="flex justify-between items-center">
            <h2 class="text-2xl font-bold text-gray-800">NET CASH FLOW</h2>
            <p class="text-3xl font-bold {% if net_cash_flow >= 0 %}text-blue-600{% else %}text-orange-600{% endif %}">
                {% if net_cash_flow >= 0 %}+{% endif %}‚Çπ{{ "%.2f"|format(net_cash_flow) }}
            </p>
        </div>
    </div>
</div>
{% endblock %}
